创建内表
-	
	create  table point_10m
	(WTG_ID int,
	DATA_TIME TIMESTAMP,
	PRODUCTION_ACTIVE_ACCUM DECIMAL(22,6),
	PRODUCTION_REACTIVE_ACCUM DECIMAL(22,6),
	CONSUMPTION_ACTIVE_ACCUM DECIMAL(22,6),
	CONSUMPTION_REACTIVE_ACCUM DECIMAL(22,6),
	POWER_CURVE_STATE_AVG DECIMAL(22,6),
	POWER_CURVE_STATE_MAX DECIMAL(22,6),
	POWER_CURVE_STATE_MIN DECIMAL(22,6),
	POWER_CURVE_STATE_STD DECIMAL(22,6),
	POWER_CURVE_STATE_VALID DECIMAL(22,6),
	WIND_SPEED_AVG DECIMAL(22,6),
	WIND_SPEED_MAX DECIMAL(22,6),
	WIND_SPEED_MIN DECIMAL(22,6),
	WIND_SPEED_STD DECIMAL(22,6),
	WIND_SPEED_REVISE DECIMAL(22,6),
	WIND_SPEED_REVISE_SITE DECIMAL(22,6),
	WIND_SPEED_ESTIMATE DECIMAL(22,6),
	WIND_SPEED_RANK DECIMAL(22,6),
	ACTIVE_POWER_AVG DECIMAL(22,6),
	ACTIVE_POWER_MAX DECIMAL(22,6),
	ACTIVE_POWER_MIN DECIMAL(22,6),
	ACTIVE_POWER_STD DECIMAL(22,6),
	ACTIVE_POWER_THEORETIC DECIMAL(22,6),
	ACTIVE_POWER_CALC_AVG DECIMAL(22,6),
	ACTIVE_POWER_CALC_MAX DECIMAL(22,6),
	ACTIVE_POWER_CALC_MIN DECIMAL(22,6),
	ACTIVE_POWER_CALC_STD DECIMAL(22,6),
	WIND_DIRECTION_AVG DECIMAL(22,6),
	WIND_DIRECTION_MAX DECIMAL(22,6),
	WIND_DIRECTION_MIN DECIMAL(22,6),
	WIND_DIRECTION_STD DECIMAL(22,6),
	WIND_VANE_AVG DECIMAL(22,6),
	WIND_VANE_MAX DECIMAL(22,6),
	WIND_VANE_MIN DECIMAL(22,6),
	WIND_VANE_STD DECIMAL(22,6),
	TEMP_OUT_DOOR_AVG DECIMAL(22,6),
	TEMP_OUT_DOOR_MAX DECIMAL(22,6),
	TEMP_OUT_DOOR_MIN DECIMAL(22,6),
	TEMP_OUT_DOOR_STD DECIMAL(22,6),
	TEMP_OUT_DOOR_AVG_SITE DECIMAL(22,6),
	ATOM_PRESSURE_AVG DECIMAL(22,6),
	ATOM_PRESSURE_MAX DECIMAL(22,6),
	ATOM_PRESSURE_MIN DECIMAL(22,6),
	ATOM_PRESSURE_STD DECIMAL(22,6),
	GEN_SPEED_AVG DECIMAL(22,6),
	GEN_SPEED_MAX DECIMAL(22,6),
	GEN_SPEED_MIN DECIMAL(22,6),
	GEN_SPEED_STD DECIMAL(22,6),
	PITCH_ANGLE_AVG DECIMAL(22,6),
	PITCH_ANGLE_MAX DECIMAL(22,6),
	PITCH_ANGLE_MIN DECIMAL(22,6),
	PITCH_ANGLE_STD DECIMAL(22,6),
	READ_WIND_SPEED_AVG DECIMAL(22,6),
	READ_WIND_SPEED_MAX DECIMAL(22,6),
	READ_WIND_SPEED_MIN DECIMAL(22,6),
	READ_WIND_SPEED_STD DECIMAL(22,6),
	TORQUE_SETPOINT_AVG DECIMAL(22,6),
	TORQUE_SETPOINT_MAX DECIMAL(22,6),
	TORQUE_SETPOINT_MIN DECIMAL(22,6),
	TORQUE_SETPOINT_STD DECIMAL(22,6),
	TORQUE_AVG DECIMAL(22,6),
	TORQUE_MAX DECIMAL(22,6),
	TORQUE_MIN DECIMAL(22,6),
	TORQUE_STD DECIMAL(22,6),
	NACELLE_POSITION_AVG DECIMAL(22,6),
	NACELLE_POSITION_MAX DECIMAL(22,6),
	NACELLE_POSITION_MIN DECIMAL(22,6),
	NACELLE_POSITION_STD DECIMAL(22,6),
	ROTOR_SPD_AVG DECIMAL(22,6),
	ROTOR_SPD_MAX DECIMAL(22,6),
	ROTOR_SPD_MIN DECIMAL(22,6),
	ROTOR_SPD_STD DECIMAL(22,6),
	PRODUCTION_ACTIVE DECIMAL(22,6),
	PRODUCTION_CONSUMED DECIMAL(22,6),
	PRODUCTION_NET DECIMAL(22,6),
	PRODUCTION_THEORETIC DECIMAL(22,6),
	AIR_DENSITY_AVG DECIMAL(22,6),
	WTG_STATUS DECIMAL(22,6),
	DOWNTIME_REASON DECIMAL(22,6))
	COMMENT 'SCADAPOINTVALUE10M'
	ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
	STORED AS TEXTFILE;
	LOAD DATA INPATH '/user/hive/warehouse/point_10m/' INTO TABLE point_10m;


创建外表
-

	create external table point_10m_ext
	(WTG_ID int,
	DATA_TIME TIMESTAMP,
	PRODUCTION_ACTIVE_ACCUM DECIMAL(22,6),
	PRODUCTION_REACTIVE_ACCUM DECIMAL(22,6),
	CONSUMPTION_ACTIVE_ACCUM DECIMAL(22,6),
	CONSUMPTION_REACTIVE_ACCUM DECIMAL(22,6),
	POWER_CURVE_STATE_AVG DECIMAL(22,6),
	POWER_CURVE_STATE_MAX DECIMAL(22,6),
	POWER_CURVE_STATE_MIN DECIMAL(22,6),
	POWER_CURVE_STATE_STD DECIMAL(22,6),
	POWER_CURVE_STATE_VALID DECIMAL(22,6),
	WIND_SPEED_AVG DECIMAL(22,6),
	WIND_SPEED_MAX DECIMAL(22,6),
	WIND_SPEED_MIN DECIMAL(22,6),
	WIND_SPEED_STD DECIMAL(22,6),
	WIND_SPEED_REVISE DECIMAL(22,6),
	WIND_SPEED_REVISE_SITE DECIMAL(22,6),
	WIND_SPEED_ESTIMATE DECIMAL(22,6),
	WIND_SPEED_RANK DECIMAL(22,6),
	ACTIVE_POWER_AVG DECIMAL(22,6),
	ACTIVE_POWER_MAX DECIMAL(22,6),
	ACTIVE_POWER_MIN DECIMAL(22,6),
	ACTIVE_POWER_STD DECIMAL(22,6),
	ACTIVE_POWER_THEORETIC DECIMAL(22,6),
	ACTIVE_POWER_CALC_AVG DECIMAL(22,6),
	ACTIVE_POWER_CALC_MAX DECIMAL(22,6),
	ACTIVE_POWER_CALC_MIN DECIMAL(22,6),
	ACTIVE_POWER_CALC_STD DECIMAL(22,6),
	WIND_DIRECTION_AVG DECIMAL(22,6),
	WIND_DIRECTION_MAX DECIMAL(22,6),
	WIND_DIRECTION_MIN DECIMAL(22,6),
	WIND_DIRECTION_STD DECIMAL(22,6),
	WIND_VANE_AVG DECIMAL(22,6),
	WIND_VANE_MAX DECIMAL(22,6),
	WIND_VANE_MIN DECIMAL(22,6),
	WIND_VANE_STD DECIMAL(22,6),
	TEMP_OUT_DOOR_AVG DECIMAL(22,6),
	TEMP_OUT_DOOR_MAX DECIMAL(22,6),
	TEMP_OUT_DOOR_MIN DECIMAL(22,6),
	TEMP_OUT_DOOR_STD DECIMAL(22,6),
	TEMP_OUT_DOOR_AVG_SITE DECIMAL(22,6),
	ATOM_PRESSURE_AVG DECIMAL(22,6),
	ATOM_PRESSURE_MAX DECIMAL(22,6),
	ATOM_PRESSURE_MIN DECIMAL(22,6),
	ATOM_PRESSURE_STD DECIMAL(22,6),
	GEN_SPEED_AVG DECIMAL(22,6),
	GEN_SPEED_MAX DECIMAL(22,6),
	GEN_SPEED_MIN DECIMAL(22,6),
	GEN_SPEED_STD DECIMAL(22,6),
	PITCH_ANGLE_AVG DECIMAL(22,6),
	PITCH_ANGLE_MAX DECIMAL(22,6),
	PITCH_ANGLE_MIN DECIMAL(22,6),
	PITCH_ANGLE_STD DECIMAL(22,6),
	READ_WIND_SPEED_AVG DECIMAL(22,6),
	READ_WIND_SPEED_MAX DECIMAL(22,6),
	READ_WIND_SPEED_MIN DECIMAL(22,6),
	READ_WIND_SPEED_STD DECIMAL(22,6),
	TORQUE_SETPOINT_AVG DECIMAL(22,6),
	TORQUE_SETPOINT_MAX DECIMAL(22,6),
	TORQUE_SETPOINT_MIN DECIMAL(22,6),
	TORQUE_SETPOINT_STD DECIMAL(22,6),
	TORQUE_AVG DECIMAL(22,6),
	TORQUE_MAX DECIMAL(22,6),
	TORQUE_MIN DECIMAL(22,6),
	TORQUE_STD DECIMAL(22,6),
	NACELLE_POSITION_AVG DECIMAL(22,6),
	NACELLE_POSITION_MAX DECIMAL(22,6),
	NACELLE_POSITION_MIN DECIMAL(22,6),
	NACELLE_POSITION_STD DECIMAL(22,6),
	ROTOR_SPD_AVG DECIMAL(22,6),
	ROTOR_SPD_MAX DECIMAL(22,6),
	ROTOR_SPD_MIN DECIMAL(22,6),
	ROTOR_SPD_STD DECIMAL(22,6),
	PRODUCTION_ACTIVE DECIMAL(22,6),
	PRODUCTION_CONSUMED DECIMAL(22,6),
	PRODUCTION_NET DECIMAL(22,6),
	PRODUCTION_THEORETIC DECIMAL(22,6),
	AIR_DENSITY_AVG DECIMAL(22,6),
	WTG_STATUS DECIMAL(22,6),
	DOWNTIME_REASON DECIMAL(22,6))
	COMMENT 'SCADAPOINTVALUE10M'
	ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
	STORED AS TEXTFILE
	LOCATION '/user/hive/warehouse/point_10m/'; ---加载hdfs文件为外表
	或
	LOAD DATA LOCAL INPATH '/tmp/yhb/point' INTO TABLE point_10m_ext; ---加载本地文件到hdfs的数据仓库中

 
wtg 内表
-
	create table wtg(
	wtg_id         int,
	wtg_name       string,
	l_id     int,
	f_id     int)
	COMMENT 'WTG INFO'
	ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
	STORED AS TEXTFILE;
	
	LOAD DATA LOCAL INPATH '/tmp/yhb/wtg.csv' INTO TABLE wtg;


DT 内表
-
	create table dt(
	wtg_id int,
	start_time timestamp,
	end_time date,
	sc_id int,
	ss_id int,
	dt_id int,
	sy_id int,
	cm_id int,
	rn_id int,
	rb_id int)
	COMMENT 'DT RECORD'
	ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
	STORED AS TEXTFILE;
	
	LOAD DATA LOCAL INPATH '/tmp/yhb/dt.csv' INTO TABLE dt;

pc 内表
-
	create table pc(
	wtg_id int,
	windspeed DECIMAL(22,6),
	power_theory DECIMAL(22,6)
	)COMMENT 'PC INFO'
	ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
	STORED AS TEXTFILE;
	LOAD DATA LOCAL INPATH '/tmp/yhb/pc.csv' INTO TABLE PC;



##no need to create table 
	hbase org.apache.hadoop.hbase.mapreduce.ImportTsv -Dimporttsv.separator=, -Dimporttsv.bulk.output=qkp/h_point10m.csv -Dimporttsv.columns=HBASE_ROW_KEY,a:10,a:11,a:12,a:13,a:14,a:15,a:16,a:17,a:18,a:19,a:20,a:21,a:22,a:23,a:24,a:25,a:26,a:27,a:28,a:29,a:30,a:31,a:32,a:33,a:34,a:35,a:36,a:37,a:38,a:39,a:40,a:41,a:42,a:43,a:44,a:45,a:46,a:47,a:48,a:49,a:50,a:51,a:52,a:53,a:54,a:55,a:56,a:57,a:58,a:59,a:60,a:61,a:62,a:63,a:64,a:65,a:66,a:67,a:68,a:69,a:70,a:71,a:72,a:73,a:74,a:75,a:76,a:77,a:78,a:79,a:80,a:81,a:82,a:83,a:84,a:85,a:86,a:87,a:88,a:89 im_test qkp/point10m.csv 
	
	hadoop fs -chmod -R 777 qkp/h_point10m.csv
	hbase org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles qkp/h_point10m.csv im_test
	
	
	hbase org.apache.hadoop.hbase.mapreduce.ImportTsv -Dimporttsv.separator=, -Dimporttsv.bulk.output=csvfile/h_testMSdata2 -Dimporttsv.columns=HBASE_ROW_KEY,a:a,a:b,a:c,a:d,a:e,a:f,a:g data_ocean_clytest csvfile/testMSdata2
	hadoop fs -chmod -R 777 csvfile/h_testMSdata2
	hbase org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles csvfile/h_testMSdata2 data_ocean_clytest



####

	CREATE EXTERNAL TABLE hbase_point10m(
	key string,
	WTG_ID int,
	DATA_TIME string,
	PRODUCTION_ACTIVE_ACCUM DECIMAL(22,6),
	PRODUCTION_REACTIVE_ACCUM DECIMAL(22,6),
	CONSUMPTION_ACTIVE_ACCUM DECIMAL(22,6),
	CONSUMPTION_REACTIVE_ACCUM DECIMAL(22,6),
	POWER_CURVE_STATE_AVG DECIMAL(22,6),
	POWER_CURVE_STATE_MAX DECIMAL(22,6),
	POWER_CURVE_STATE_MIN DECIMAL(22,6),
	POWER_CURVE_STATE_STD DECIMAL(22,6),
	POWER_CURVE_STATE_VALID DECIMAL(22,6),
	WIND_SPEED_AVG DECIMAL(22,6),
	WIND_SPEED_MAX DECIMAL(22,6),
	WIND_SPEED_MIN DECIMAL(22,6),
	WIND_SPEED_STD DECIMAL(22,6),
	WIND_SPEED_REVISE DECIMAL(22,6),
	WIND_SPEED_REVISE_SITE DECIMAL(22,6),
	WIND_SPEED_ESTIMATE DECIMAL(22,6),
	WIND_SPEED_RANK DECIMAL(22,6),
	ACTIVE_POWER_AVG DECIMAL(22,6),
	ACTIVE_POWER_MAX DECIMAL(22,6),
	ACTIVE_POWER_MIN DECIMAL(22,6),
	ACTIVE_POWER_STD DECIMAL(22,6),
	ACTIVE_POWER_THEORETIC DECIMAL(22,6),
	ACTIVE_POWER_CALC_AVG DECIMAL(22,6),
	ACTIVE_POWER_CALC_MAX DECIMAL(22,6),
	ACTIVE_POWER_CALC_MIN DECIMAL(22,6),
	ACTIVE_POWER_CALC_STD DECIMAL(22,6),
	WIND_DIRECTION_AVG DECIMAL(22,6),
	WIND_DIRECTION_MAX DECIMAL(22,6),
	WIND_DIRECTION_MIN DECIMAL(22,6),
	WIND_DIRECTION_STD DECIMAL(22,6),
	WIND_VANE_AVG DECIMAL(22,6),
	WIND_VANE_MAX DECIMAL(22,6),
	WIND_VANE_MIN DECIMAL(22,6),
	WIND_VANE_STD DECIMAL(22,6),
	TEMP_OUT_DOOR_AVG DECIMAL(22,6),
	TEMP_OUT_DOOR_MAX DECIMAL(22,6),
	TEMP_OUT_DOOR_MIN DECIMAL(22,6),
	TEMP_OUT_DOOR_STD DECIMAL(22,6),
	TEMP_OUT_DOOR_AVG_SITE DECIMAL(22,6),
	ATOM_PRESSURE_AVG DECIMAL(22,6),
	ATOM_PRESSURE_MAX DECIMAL(22,6),
	ATOM_PRESSURE_MIN DECIMAL(22,6),
	ATOM_PRESSURE_STD DECIMAL(22,6),
	GEN_SPEED_AVG DECIMAL(22,6),
	GEN_SPEED_MAX DECIMAL(22,6),
	GEN_SPEED_MIN DECIMAL(22,6),
	GEN_SPEED_STD DECIMAL(22,6),
	PITCH_ANGLE_AVG DECIMAL(22,6),
	PITCH_ANGLE_MAX DECIMAL(22,6),
	PITCH_ANGLE_MIN DECIMAL(22,6),
	PITCH_ANGLE_STD DECIMAL(22,6),
	READ_WIND_SPEED_AVG DECIMAL(22,6),
	READ_WIND_SPEED_MAX DECIMAL(22,6),
	READ_WIND_SPEED_MIN DECIMAL(22,6),
	READ_WIND_SPEED_STD DECIMAL(22,6),
	TORQUE_SETPOINT_AVG DECIMAL(22,6),
	TORQUE_SETPOINT_MAX DECIMAL(22,6),
	TORQUE_SETPOINT_MIN DECIMAL(22,6),
	TORQUE_SETPOINT_STD DECIMAL(22,6),
	TORQUE_AVG DECIMAL(22,6),
	TORQUE_MAX DECIMAL(22,6),
	TORQUE_MIN DECIMAL(22,6),
	TORQUE_STD DECIMAL(22,6),
	NACELLE_POSITION_AVG DECIMAL(22,6),
	NACELLE_POSITION_MAX DECIMAL(22,6),
	NACELLE_POSITION_MIN DECIMAL(22,6),
	NACELLE_POSITION_STD DECIMAL(22,6),
	ROTOR_SPD_AVG DECIMAL(22,6),
	ROTOR_SPD_MAX DECIMAL(22,6),
	ROTOR_SPD_MIN DECIMAL(22,6),
	ROTOR_SPD_STD DECIMAL(22,6),
	PRODUCTION_ACTIVE DECIMAL(22,6),
	PRODUCTION_CONSUMED DECIMAL(22,6),
	PRODUCTION_NET DECIMAL(22,6),
	PRODUCTION_THEORETIC DECIMAL(22,6),
	AIR_DENSITY_AVG DECIMAL(22,6),
	WTG_STATUS DECIMAL(22,6),
	DOWNTIME_REASON DECIMAL(22,6)
	)
	STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'
	WITH SERDEPROPERTIES ('hbase.columns.mapping' = ':key#string,a:10#string,a:11#string,a:12#string,a:13#string,a:14#string,a:15#string,a:16#string,a:17#string,a:18#string,a:19#string,a:20#string,a:21#string,a:22#string,a:23#string,a:24#string,a:25#string,a:26#string,a:27#string,a:28#string,a:29#string,a:30#string,a:31#string,a:32#string,a:33#string,a:34#string,a:35#string,a:36#string,a:37#string,a:38#string,a:39#string,a:40#string,a:41#string,a:42#string,a:43#string,a:44#string,a:45#string,a:46#string,a:47#string,a:48#string,a:49#string,a:50#string,a:51#string,a:52#string,a:53#string,a:54#string,a:55#string,a:56#string,a:57#string,a:58#string,a:59#string,a:60#string,a:61#string,a:62#string,a:63#string,a:64#string,a:65#string,a:66#string,a:67#string,a:68#string,a:69#string,a:70#string,a:71#string,a:72#string,a:73#string,a:74#string,a:75#string,a:76#string,a:77#string,a:78#string,a:79#string,a:80#string,a:81#string,a:82#string,a:83#string,a:84#string,a:85#string,a:86#string,a:87#string,a:88#string,a:89#string')
	TBLPROPERTIES ('hbase.table.name' = 'im_test');


#delete trash
 	hadoop fs -expunge
 
# hive insert 

	insert overwrite table app_wtg 
	SELECT WTG_ID,DATA_TIME,t1.APP FROM (SELECT WTG_ID,
	    DATA_TIME,
	    LEAD(production_active)OVER(PARTITION BY WTG_ID ORDER BY DATA_TIME)-production_active as APP
	  FROM hbase_point10m 
	  WHERE production_active > 0 ) t1
	WHERE t1.APP>0;

 
 

pointvalue file pre-handle
 -
 
	cat  ../yhb/wtg10m2013.csv  |awk -F, '{$1="";$2="";$3="";OFS=",";gsub(" ","",$5);gsub("-","",$5);gsub(":","",$5);printf("%s",$5$4);for(i=4;i<84;i++){printf(",%s",$i)};printf("\n");}' >point10m.csv 


	cat a.csv  |awk -v a='2009/11/25' '{{if($1!=a){printf("\n");printf("%s",$0);}else printf("%s",$0)}a=$1;}' > c

	cat c.csv |awk -F, '{printf("\n%s,",$1);gsub(" ","",$1);gsub("/","",$1);gsub(":","",$1);printf("%s",substr($1,1,8));for(i=2;i<=NF;i++)printf(",%s",$i)}'